# Building Poor House Juno

## Problem: No Audio / Blank Oscilloscope

If you're seeing no audio output and a blank oscilloscope, it's because the **WASM files are not built yet**.

The web interface requires two files that are generated by compiling the C++ code:
- `web/synth-processor.js`
- `web/synth-processor.wasm`

These files are **not included in the repository** and must be built using Emscripten.

---

## Solutions

### Option 1: Build on Linux/macOS/WSL (Recommended)

**Install Emscripten:**
```bash
# Clone Emscripten SDK
git clone https://github.com/emscripten-core/emsdk.git
cd emsdk

# Install and activate
./emsdk install latest
./emsdk activate latest
source ./emsdk_env.sh
```

**Build:**
```bash
cd /path/to/poor-house-juno
./scripts/build_web.sh
```

**Verify build artifacts exist:**
```bash
ls -lh web/synth-processor.*
# Should show:
# web/synth-processor.js
# web/synth-processor.wasm
```

**Serve and test:**
```bash
cd web
python3 -m http.server 8000
# Open http://localhost:8000
```

---

### Option 2: Use WSL on Windows

**Install WSL:**
```powershell
# Run in PowerShell as Administrator
wsl --install
```

**Restart your computer, then:**
```bash
# In WSL terminal
cd /mnt/c/Users/parkr/Cursor_Projects/poor-house-juno

# Follow Option 1 steps above
```

---

### Option 3: Use Docker

**Create Dockerfile:**
```dockerfile
FROM emscripten/emsdk:latest
WORKDIR /src
COPY . .
RUN ./scripts/build_web.sh
```

**Build:**
```bash
docker build -t poor-house-juno .
docker cp $(docker create poor-house-juno):/src/web/synth-processor.js web/
docker cp $(docker create poor-house-juno):/src/web/synth-processor.wasm web/
```

---

### Option 4: GitHub Actions (Automated)

**Create `.github/workflows/build-web.yml`:**
```yaml
name: Build Web

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Install Emscripten
        run: |
          git clone https://github.com/emscripten-core/emsdk.git
          cd emsdk
          ./emsdk install latest
          ./emsdk activate latest
      
      - name: Build
        run: |
          source emsdk/emsdk_env.sh
          ./scripts/build_web.sh
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: wasm-build
          path: |
            web/synth-processor.js
            web/synth-processor.wasm
```

Then download the artifacts from GitHub Actions.

---

### Option 5: Deploy to GitHub Pages (Easiest)

**One-time setup (on Linux/macOS/WSL):**
```bash
# Install Emscripten (see Option 1)

# Build and deploy
./scripts/deploy_web.sh
```

This will:
1. Build the WASM files
2. Create/update `gh-pages` branch
3. Push to GitHub
4. Make it available at: `https://parkredding.github.io/poor-house-juno/`

**Configure GitHub Pages:**
1. Go to repository Settings > Pages
2. Select `gh-pages` branch as source
3. Save

Visit your live site in 2-3 minutes!

---

## Troubleshooting

### "Failed to load AudioWorklet" error
**Cause:** Missing WASM files  
**Solution:** Build with Emscripten (see options above)

### "Cannot import synth-processor.js" error
**Cause:** WASM files not built  
**Solution:** Run `./scripts/build_web.sh`

### Blank oscilloscope / no audio
**Cause:** WASM module failed to initialize  
**Solution:** Open browser console (F12) and check for errors

### "Emscripten not found" error
**Cause:** Emscripten not installed or not in PATH  
**Solution:** 
```bash
source /path/to/emsdk/emsdk_env.sh
```

---

## Quick Check: Are WASM files built?

```bash
ls web/synth-processor.*
```

**If you see:**
- ✅ `synth-processor.js` and `synth-processor.wasm` → Build successful!
- ❌ No such file or directory → Need to build (see options above)

---

## Recommended Workflow for Windows Users

1. **Install WSL** (one-time)
   ```powershell
   wsl --install
   ```

2. **Install Emscripten in WSL** (one-time)
   ```bash
   git clone https://github.com/emscripten-core/emsdk.git
   cd emsdk
   ./emsdk install latest
   ./emsdk activate latest
   ```

3. **Build** (every time you change C++ code)
   ```bash
   cd /mnt/c/Users/parkr/Cursor_Projects/poor-house-juno
   source ~/emsdk/emsdk_env.sh
   ./scripts/build_web.sh
   ```

4. **Test** (in Windows browser)
   ```bash
   cd web
   python3 -m http.server 8000
   ```
   Open http://localhost:8000 in Windows browser

---

## Build Time Expectations

- **First build:** 2-5 minutes (downloads dependencies)
- **Incremental builds:** 10-30 seconds
- **Clean build:** 1-2 minutes

---

## Need Help?

See the project documentation:
- `README.md` - Project overview
- `M16_TESTING_GUIDE.md` - Testing procedures
- `docs/web_interface.md` - Web architecture details

Or check console for specific error messages (F12 in browser).
